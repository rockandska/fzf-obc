if ! ((current_git_is_ref));then
	current_fzf_preview="
		echo -n {} \
			| sed -r -z 's/^.*][[:space:]]//' \
			| sed -r -z 's/.* -> +//' \
			| sed -r -z 's/^ +//g;s/ +$//g' \
			| xargs -0 printf '%q' \
			| xargs -0 -n 1 bash -c '
				if ! git ls-files --error-unmatch \"\$1\" &> /dev/null;then
					git diff --color=always -- /dev/null \"\$1\"
				else
					git diff --color=always -- \"\$1\"
				fi
			' _
	"
else
	current_fzf_preview="
		echo -n {} \
			| sed -r -z 's/^ +//g;s/ +$//g' \
			| xargs -0 printf '%q' \
			| xargs -0 -n 1 bash -c 'git diff --color=always \"\$1\"' _
	"
fi

if [[ "${current_git_cmd}" == "diff" ]];then
	if ((current_git_is_ref));then
		current_fzf_opts+=" -m2"
	fi
fi
